(function(){var h=tinymce.DOM;var e=tinymce.dom.Event;var f=tinymce.util.Dispatcher;var d=tinymce.util.JSON;var b=tinymce.util.XHR;var g=function(j){if(typeof YAHOO=="undefined"||typeof YAHOO.util=="undefined"||typeof YAHOO.util.Dom=="undefined"){var k=h.getRect(j)}else{var k=YAHOO.util.Dom.getRegion(j);k.x=k.left;k.y=k.top;k.w=k.right-k.left;k.h=k.bottom-k.top}return k};var c=function(){var l=h.getViewPort();var k=(typeof document.scrollHeight=="undefined")?document.body.scrollHeight:document.scrollHeight;var j=Math.max(k,l.h);return j};var i=function(m){var j=m.getContainer();var l;for(var k=0;k<j.childNodes.length;k++){if(h.hasClass(j.childNodes[k],"mceLayout")){l=j.childNodes[k];break}}return l};tinymce.PluginManager.requireLangPack("swat");var a={isFunction:function(j){return Object.prototype.toString.apply(j)==="[object Function]"},_IEEnumFix:(tinymce.isIE)?function(m,l){var j,o,n;var k=["toString","valueOf"];for(j=0;j<k.length;j=j+1){o=k[j];n=l[o];if(a.isFunction(n)&&n!=Object.prototype[o]){m[o]=n}}}:function(){},hasOwnProperty:(Object.prototype.hasOwnProperty)?function(j,k){return(j&&j.hasOwnProperty(k))}:function(j,k){return(!a.isUndefined(j[k])&&j.constructor.prototype[k]!==j[k])},isUndefined:function(j){return typeof j==="undefined"},extend:function(m,n,l){if(!n||!m){throw new Error("extend failed, please check that all dependencies are included.")}var k=function(){},j;k.prototype=n.prototype;m.prototype=new k();m.prototype.constructor=m;m.superclass=n.prototype;if(n.prototype.constructor==Object.prototype.constructor){n.prototype.constructor=n}if(l){for(j in l){if(a.hasOwnProperty(l,j)){m.prototype[j]=l[j]}}a._IEEnumFix(m.prototype,l)}}};a.MODE_VISUAL=1;a.MODE_SOURCE=2;a.Dialog=function(j){this.editor=j;this.selection=null;this.frame=null;this.container=null;this.drawOverlay();this.drawDialog();this.onConfirm=new f(this);this.onCancel=new f(this)};a.Dialog.prototype.reset=function(){};a.Dialog.prototype.focus=function(){};a.Dialog.prototype.getData=function(){return{}};a.Dialog.prototype.setData=function(j){};a.Dialog.prototype.close=function(m){var j=this.editor;this.overlay.style.display="none";this.container.style.display="none";if(tinymce.isIE6){selectElements=h.doc.getElementsByTagName("select");for(var k=0;k<selectElements.length;k++){if(typeof selectElements[k].style._visibility!="undefined"){selectElements[k].style.visibility=selectElements[k].style._visibility}}}var l=(j.settings.content_editable)?j.getBody():(!tinymce.isGecko)?j.getWin():j.getDoc();e.remove(l,"focus",this.handleEditorFocus);j.focus();if(this.selection){j.selection.moveToBookmark(this.selection)}if(m){this.onConfirm.dispatch(this,this.getData())}else{this.onCancel.dispatch(this)}this.reset();e.remove(h.doc,"keydown",this.handleKeyPress)};a.Dialog.prototype.open=function(m){var o=this.editor;this.selection=o.selection.getBookmark();var l=(o.settings.content_editable)?o.getBody():(!tinymce.isGecko)?o.getWin():o.getDoc();e.add(l,"focus",this.handleEditorFocus,this);this.setData(m);if(tinymce.isIE6){selectElements=h.doc.getElementsByTagName("select");for(var n=0;n<selectElements.length;n++){selectElements[n].style._visibility=selectElements[n].style.visibility;selectElements[n].style.visibility="hidden"}}SwatZIndexManager.raiseElement(this.overlay);SwatZIndexManager.raiseElement(this.container);this.container.style.left="-10000px";this.container.style.top="-10000px";this.container.style.display="block";var q=g(this.container);var k=i(o);if(k){var j=g(k);var r=j.x+((j.w-q.w)/2);var p=j.y+30;this.overlay.style.height=c()+"px";this.overlay.style.display="block";this.container.style.left=r+"px";this.container.style.top=p+"px";this.container.style.display="block"}this.focus();e.add(h.doc,"keydown",this.handleKeyPress,this)};a.Dialog.prototype.drawDialog=function(){this.frame=h.create("div");this.frame.className="swat-frame";this.container=h.create("div");this.container.style.display="none";this.container.className="swat-textarea-editor-dialog";this.container.appendChild(this.frame);h.doc.body.appendChild(this.container)};a.Dialog.prototype.drawOverlay=function(){this.overlay=h.create("div");this.overlay.className="swat-textarea-editor-overlay";h.doc.body.appendChild(this.overlay)};a.Dialog.prototype.handleKeyPress=function(j){var k=(j.which)?j.which:((j.keyCode)?j.keyCode:j.charCode);if(k==27){this.close(false)}};a.Dialog.prototype.handleEditorFocus=function(j){window.focus();this.focus()};a.LinkDialog=function(j){a.LinkDialog.superclass.constructor.call(this,j)};a.extend(a.LinkDialog,a.Dialog,{focus:function(){this.uriEntry.focus()},reset:function(){this.uriEntry.value=""},getData:function(){var j=a.LinkDialog.superclass.getData.call(this);j.link_uri=this.uriEntry.value;return j},setData:function(j){a.LinkDialog.superclass.setData.call(this,j);if(j.link_uri){this.uriEntry.value=j.link_uri}},open:function(j){a.LinkDialog.superclass.open.call(this,j);if(this.uriEntry.value.length){this.insertButton.value=this.editor.getLang("swat.link_update");this.entryNote.style.display="block"}else{this.insertButton.value=this.editor.getLang("swat.link_insert");this.entryNote.style.display="none"}},drawDialog:function(){a.LinkDialog.superclass.drawDialog.call(this);var m=this.editor.id+"_link_entry";this.uriEntry=h.create("input",{id:m,type:"text"});this.uriEntry.className="swat-entry";e.add(this.uriEntry,"focus",function(r){this.select()},this.uriEntry);var k=h.create("label");k.htmlFor=m;k.appendChild(h.doc.createTextNode(this.editor.getLang("swat.link_uri_field")));var l=h.create("div");l.className="swat-form-field-contents";l.appendChild(this.uriEntry);this.entryNote=h.create("div");this.entryNote.className="swat-note";this.entryNote.appendChild(h.doc.createTextNode(this.editor.getLang("swat.link_uri_field_note")));var p=h.create("div");p.className="swat-form-field";p.appendChild(k);p.appendChild(l);p.appendChild(this.entryNote);this.insertButton=h.create("input",{type:"button"});this.insertButton.className="swat-button swat-primary";this.insertButton.value=this.editor.getLang("swat.link_insert");e.add(this.insertButton,"click",function(r){this.close(true)},this);var o=h.create("input",{type:"button"});o.className="swat-button";o.value=this.editor.getLang("swat.link_cancel");e.add(o,"click",function(r){this.close(false)},this);var q=h.create("div");q.className="swat-form-field-contents";q.appendChild(this.insertButton);q.appendChild(o);var j=h.create("div");j.className="swat-footer-form-field";j.appendChild(q);var n=h.create("form");n.className="swat-form";n.appendChild(p);n.appendChild(j);e.add(n,"submit",function(r){e.cancel(r);this.close(true)},this);this.frame.appendChild(n)}});a.ImageDialog=function(j,k){this.imageServer=k;this.uploadImage=0;this.notebookPage=0;a.ImageDialog.superclass.constructor.call(this,j)};a.extend(a.ImageDialog,a.Dialog,{focus:function(){if(h.hasClass(this.notebookPages[1],"swat-textarea-editor-notebook-page-selected")){this.srcEntry.focus()}else{this.uploadAltEntry.focus()}},reset:function(){this.srcEntry.value="";this.uriAltEntry.value="";this.uploadAltEntry.value="";this.uploadCaptionEntry.value="";if(typeof this.imageData!="undefined"&&this.imageData.length){this.selectUploadImage(0);this.selectNotebookPage(0)}},getData:function(){var k=a.ImageDialog.superclass.getData.call(this);k.image_src=this.srcEntry.value;k.image_alt=this.uriAltEntry.value;if(this.notebookPage==0){var n=this.imageData[this.uploadImage];var m=this.uploadImageDimensionRadios[this.uploadImage];var j;for(j in m){if(m[j].checked){break}}var l=n.images[j];k.image_upload={src:l.uri,width:l.width,height:l.height,alt:this.uploadAltEntry.value,caption:this.uploadCaptionEntry.value}}else{k.image_upload=null}return k},setData:function(m){a.ImageDialog.superclass.setData.call(this,m);var l=false;if(this.imageData){var k,j,n;for(k=0;k<this.imageData.length;k++){for(j in this.imageData[k].images){n=this.imageData[k].images[j];if(m.image_src==n.uri){this.selectNotebookPage(0);this.selectUploadImage(k);this.uploadImageDimensionRadios[k][j].checked=true;if(m.image_alt){this.uploadAltEntry.value=m.image_alt}l=true;break}}if(l){break}}}if(!l&&(m.image_src||m.image_alt)){this.selectNotebookPage(1);if(m.image_src){this.srcEntry.value=m.image_src}if(m.image_alt){this.uriAltEntry.value=m.image_alt}}if(l||this.srcEntry.value.length){this.insertButton.value=this.editor.getLang("swat.image_update");this.hideCaption()}else{this.insertButton.value=this.editor.getLang("swat.image_insert");this.showCaption()}},open:function(j){a.ImageDialog.superclass.open.call(this,j)},drawDialog:function(){a.ImageDialog.superclass.drawDialog.call(this);this.notebookTabs=[];this.notebookPages=[];var s=h.create("div",{id:this.editor.id+"_image_notebook_tabs","class":"swat-textarea-editor-notebook-tabs"});var D=h.create("div",{id:this.editor.id+"_image_notebook_pages","class":"swat-textarea-editor-notebook-pages"});this.notebookTabs[0]=h.create("a",{href:"#","class":"swat-textarea-editor-notebook-tab swat-textarea-editor-notebook-tab-selected"});this.notebookTabs[0].appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_uploads")));e.add(this.notebookTabs[0],"click",function(H){e.prevent(H);this.selectNotebookPage(0)},this);this.notebookPages[0]=h.create("div",{"class":"swat-textarea-editor-notebook-page swat-textarea-editor-notebook-page-selected"});this.uploadImageList=h.create("div",{"class":"swat-textarea-editor-upload-left"});this.uploadImageDetails=h.create("div",{"class":"swat-textarea-editor-upload-right"});var F=this.editor.id+"_image_upload_alt_entry";this.uploadAltEntry=h.create("input",{id:F,type:"text","class":"swat-entry"});e.add(this.uploadAltEntry,"focus",function(H){this.select()},this.uploadAltEntry);var C=h.create("span");C.className="swat-note";C.appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_optional")));var u=h.create("label");u.htmlFor=F;u.appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_alt_field")));u.appendChild(h.doc.createTextNode(" "));u.appendChild(C);var t=h.create("div");t.className="swat-form-field-contents";t.appendChild(this.uploadAltEntry);var l=h.create("div");l.className="swat-form-field";l.appendChild(u);l.appendChild(t);var v=this.editor.id+"_image_upload_alt_entry";this.uploadCaptionEntry=h.create("input",{id:v,type:"text","class":"swat-entry"});e.add(this.uploadCaptionEntry,"focus",function(H){this.select()},this.uploadCaptionEntry);var n=h.create("span");n.className="swat-note";n.appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_optional")));var o=h.create("label");o.htmlFor=v;o.appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_caption_field")));o.appendChild(h.doc.createTextNode(" "));o.appendChild(n);var G=h.create("div",{"class":"swat-form-field-contents"});G.appendChild(this.uploadCaptionEntry);this.uploadCaptionEntryFormField=h.create("div",{"class":"swat-form-field"});this.uploadCaptionEntryFormField.appendChild(o);this.uploadCaptionEntryFormField.appendChild(G);this.uploadImageDetails.appendChild(l);this.uploadImageDetails.appendChild(this.uploadCaptionEntryFormField);this.notebookPages[0].appendChild(this.uploadImageList);this.notebookPages[0].appendChild(this.uploadImageDetails);s.appendChild(this.notebookTabs[0]);D.appendChild(this.notebookPages[0]);this.notebookTabs[1]=h.create("a",{href:"#","class":"swat-textarea-editor-notebook-tab"});this.notebookTabs[1].appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_from_uri")));e.add(this.notebookTabs[1],"click",function(H){e.prevent(H);this.selectNotebookPage(1)},this);this.notebookPages[1]=h.create("div",{"class":"swat-textarea-editor-notebook-page"});var m=this.editor.id+"_image_src_entry";this.srcEntry=h.create("input",{id:m,type:"text"});this.srcEntry.className="swat-entry";e.add(this.srcEntry,"focus",function(H){this.select()},this.srcEntry);var B=h.create("label");B.htmlFor=m;B.appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_src_field")));var x=h.create("div");x.className="swat-form-field-contents";x.appendChild(this.srcEntry);var w=h.create("div");w.className="swat-form-field";w.appendChild(B);w.appendChild(x);var y=this.editor.id+"_image_uri_alt_entry";this.uriAltEntry=h.create("input",{id:y,type:"text"});this.uriAltEntry.className="swat-entry";e.add(this.uriAltEntry,"focus",function(H){this.select()},this.uriAltEntry);var E=h.create("span");E.className="swat-note";E.appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_optional")));var r=h.create("label");r.htmlFor=y;r.appendChild(h.doc.createTextNode(this.editor.getLang("swat.image_alt_field")));r.appendChild(h.doc.createTextNode(" "));r.appendChild(E);var j=h.create("div");j.className="swat-form-field-contents";j.appendChild(this.uriAltEntry);var q=h.create("div");q.className="swat-form-field";q.appendChild(r);q.appendChild(j);this.notebookPages[1].appendChild(w);this.notebookPages[1].appendChild(q);s.appendChild(this.notebookTabs[1]);D.appendChild(this.notebookPages[1]);this.insertButton=h.create("input",{type:"button"});this.insertButton.className="swat-button swat-primary";this.insertButton.value=this.editor.getLang("swat.image_insert");e.add(this.insertButton,"click",function(H){this.close(true)},this);var p=h.create("input",{type:"button"});p.className="swat-button";p.value=this.editor.getLang("swat.image_cancel");e.add(p,"click",function(H){this.close(false)},this);var A=h.create("div");A.className="swat-form-field-contents";A.appendChild(this.insertButton);A.appendChild(p);var z=h.create("div");z.className="swat-footer-form-field";z.appendChild(A);s.appendChild(h.create("div",{style:"clear: left"}));var k=h.create("form");k.className="swat-form";k.appendChild(s);k.appendChild(D);k.appendChild(z);e.add(k,"submit",function(H){e.cancel(H);this.close(true)},this);this.frame.appendChild(k);if(this.imageServer){this.loadUploadImages()}else{this.selectNotebookPage(1,false);this.hideNotebookPage(0)}},hideCaption:function(){this.uploadCaptionEntryFormField.style.display="none"},showCaption:function(){this.uploadCaptionEntryFormField.style.display="block"},hideNotebookPage:function(j){if(this.notebookTabs[j]){this.notebookTabs[j].style.display="none"}if(this.notebookPages[j]){this.notebookPages[j].style.display="none"}},showNotebookPage:function(j){if(this.notebookTabs[j]){this.notebookTabs[j].style.display="auto"}if(this.notebookPages[j]){this.notebookPages[j].style.display="auto"}},selectNotebookPage:function(l,j){if(l!=this.noteBookPage){for(var k=0;k<this.notebookTabs.length;k++){if(k==l){h.addClass(this.notebookTabs[k],"swat-textarea-editor-notebook-tab-selected");h.addClass(this.notebookPages[k],"swat-textarea-editor-notebook-page-selected");this.notebookPage=l}else{h.removeClass(this.notebookTabs[k],"swat-textarea-editor-notebook-tab-selected");h.removeClass(this.notebookPages[k],"swat-textarea-editor-notebook-page-selected")}}if(typeof j==="undefined"||j){this.focus()}}},selectUploadImage:function(k){if(k!=this.uploadImage){for(var j=0;j<this.uploadImages.length;j++){if(j==k){h.addClass(this.uploadImages[j],"swat-textarea-editor-upload-image-selected");h.addClass(this.uploadImageDimensions[j],"swat-textarea-editor-upload-image-dimension-list-selected");this.uploadImage=k}else{h.removeClass(this.uploadImages[j],"swat-textarea-editor-upload-image-selected");h.removeClass(this.uploadImageDimensions[j],"swat-textarea-editor-upload-image-dimension-list-selected")}}this.focus()}},loadUploadImages:function(){var k=this;function l(n,m,p){k.imageData=null;k.selectNotebookPage(1);k.hideNotebookPage(0)}function j(t,v,n){k.imageData=d.parse(t);if(typeof k.imageData=="undefined"){l(t,v,n);return}k.uploadImages=[];k.uploadImageDimensions=[];k.uploadImageDimensionRadios=[];var q,p,m,w,r,x;var u=true;for(var s=0;s<k.imageData.length;s++){q=k.imageData[s].images;if(u){k.uploadImages[s]=h.create("a",{href:"#","class":"swat-textarea-editor-upload-image swat-textarea-editor-upload-image-selected"});k.uploadImageDimensions[s]=h.create("div",{"class":"swat-textarea-editor-upload-image-dimension-list swat-textarea-editor-upload-image-dimension-list-selected"});u=false}else{k.uploadImages[s]=h.create("a",{href:"#","class":"swat-textarea-editor-upload-image"});k.uploadImageDimensions[s]=h.create("div",{"class":"swat-textarea-editor-upload-image-dimension-list"})}(function(){var o=s;e.add(k.uploadImages[s],"click",function(y){e.prevent(y);k.selectUploadImage(o)},k)})();k.uploadImages[s].appendChild(h.create("img",{src:q.pinky.uri,width:q.pinky.width,height:q.pinky.height}));k.uploadImageDimensionRadios[s]={};m=k.editor.id+"_upload_image_"+k.imageData[s].id;for(r in q){k.uploadImageDimensionRadios[s][r]=h.create("input",{type:"radio",name:m,value:r});w=h.create("label");w.appendChild(k.uploadImageDimensionRadios[s][r]);w.appendChild(document.createTextNode(q[r].title+" "));x=h.create("span");x.appendChild(document.createTextNode("("+q[r].width+" × "+q[r].height+")"));w.appendChild(x);if(r=="small"){k.uploadImageDimensionRadios[s][r].checked=true}k.uploadImageDimensions[s].appendChild(w)}k.uploadImageList.appendChild(k.uploadImages[s]);k.uploadImageDetails.insertBefore(k.uploadImageDimensions[s],k.uploadImageDetails.firstChild)}}b.send({url:this.imageServer,type:"GET",error:l,success:j})}});a.SnippetDialog=function(j){a.SnippetDialog.superclass.constructor.call(this,j)};a.extend(a.SnippetDialog,a.Dialog,{focus:function(){this.snippetEntry.focus()},reset:function(){this.snippetEntry.value=""},getData:function(){var j=a.SnippetDialog.superclass.getData.call(this);j.snippet=this.snippetEntry.value;return j},drawDialog:function(){a.SnippetDialog.superclass.drawDialog.call(this);var m=this.editor.id+"_snippet_entry";this.snippetEntry=h.create("textarea",{id:m,rows:4,cols:50});this.snippetEntry.className="swat-textarea";var k=h.create("label");k.htmlFor=m;k.appendChild(h.doc.createTextNode(this.editor.getLang("swat.snippet_field")));var l=h.create("div");l.className="swat-form-field-contents";l.appendChild(this.snippetEntry);var p=h.create("div");p.className="swat-form-field";p.appendChild(k);p.appendChild(l);insert=h.create("input",{type:"button"});insert.className="swat-button swat-primary";insert.value=this.editor.getLang("swat.snippet_insert");e.add(insert,"click",function(r){this.close(true)},this);var o=h.create("input",{type:"button"});o.className="swat-button";o.value=this.editor.getLang("swat.snippet_cancel");e.add(o,"click",function(r){this.close(false)},this);var q=h.create("div");q.className="swat-form-field-contents";q.appendChild(insert);q.appendChild(o);var j=h.create("div");j.className="swat-footer-form-field";j.appendChild(q);var n=h.create("form");n.className="swat-form";n.appendChild(p);n.appendChild(j);e.add(n,"submit",function(r){e.cancel(r);this.close(true)},this);this.frame.appendChild(n)}});tinymce.create("tinymce.plugins.SwatPlugin",{init:function(j,k){this.editor=j;var m=this;j.onLoadContent.add(this.initMode,this);var n=j.getParam("swat_modes_enabled","yes");if(n===true||(typeof n==="string"&&n.toLowerCase()!="no")){j.onPostRender.add(this.drawSourceMode,this)}this.imageServer=j.getParam("swat_image_server",null);j.onGetContent.add(function(p,s){if(this.mode!=a.MODE_SOURCE){var r="(?:p|pre|dl|div|blockquote|form|h[1-6]|table|fieldset|address|ul|ol)";var q=new RegExp("(</"+r+"[^<>]*?>(?:[\n\r\t ]</"+r+"[^<>]*?>)*)[\n\r\t ]*","g");s.content=s.content.replace(q,"$1\n\n");s.content=s.content.replace(/[\r\n\t ]*$/,"")}},this);j.onSubmit.addToTop(function(o,p){if(this.mode==a.MODE_SOURCE){this.setVisualMode()}},this);j.onBeforeRenderUI.add(function(){h.loadCSS(k+"/css/swat.css")});this.dialogs={link:new a.LinkDialog(j),snippet:new a.SnippetDialog(j),image:new a.ImageDialog(j,this.imageServer)};this.dialogs.link.onConfirm.add(function(o,q){var p=q.link_uri;this.insertLink(p)},this);this.dialogs.image.onConfirm.add(function(q,s){var u,t,r,o,p;if(s.image_upload){u=s.image_upload.src;t=s.image_upload.alt;r=s.image_upload.width;o=s.image_upload.height;p=s.image_upload.caption}else{u=s.image_src;t=s.image_alt}if(u){this.insertImage(u,t,r,o,p)}},this);this.dialogs.snippet.onConfirm.add(function(o,q){var p=q.snippet;this.insertSnippet(p)},this);j.addCommand("mceSwatLink",function(){var q=j.selection;if(q.isCollapsed()&&!j.dom.getParent(q.getNode(),"A")){return}var o=j.dom.getAttrib(q.getNode(),"href");var p={link_uri:o};m.dialogs.link.open(p)});j.addCommand("mceSwatImage",function(){var q,p=j.selection;var o=j.dom.getParent(p.getNode(),"IMG");if(o){q={image_src:j.dom.getAttrib(o,"src"),image_alt:j.dom.getAttrib(o,"alt")}}else{q={}}m.dialogs.image.open(q)});j.addCommand("mceSwatSnippet",function(){var o={};m.dialogs.snippet.open(o)});j.addButton("link",{title:"swat.link_desc",cmd:"mceSwatLink","class":"mce_link"});j.addShortcut("crtl+k","swat.link_desc","mceSwatLink");j.addButton("image",{title:"swat.image_desc",cmd:"mceSwatImage","class":"mce_image"});j.addButton("snippet",{title:"swat.snippet_desc",cmd:"mceSwatSnippet","class":"mce_snippet"});var l=this;j.onInit.add(function(){j.onNodeChange.add(function(p,o,r,q){o.setDisabled("link",(q&&r.nodeName!="A")||l.mode==a.MODE_SOURCE);o.setActive("link",r.nodeName=="A"&&!r.name&&l.mode!=a.MODE_SOURCE)})})},insertLink:function(k){var j=this.editor;var o=j.dom;var m=j.selection.getNode();m=o.getParent(m,"A");if(!k){j.execCommand("mceBeginUndoLevel");var l=j.selection.getBookmark();o.remove(m,true);j.selection.moveToBookmark(l);j.execCommand("mceEndUndoLevel");return}j.execCommand("mceBeginUndoLevel");if(m===null){j.getDoc().execCommand("unlink",false,null);j.execCommand("CreateLink",false,"#mce_temp_url#",{skip_undo:1});var n=tinymce.grep(o.select("a"),function(p){return(o.getAttrib(p,"href")=="#mce_temp_url#")});for(var l=0;l<n.length;l++){o.setAttrib(m=n[l],"href",k)}}else{o.setAttrib(m,"href",k)}if(m.childNodes.length!=1||m.firstChild.nodeName!="IMG"){j.focus();j.selection.select(m);j.selection.collapse(false)}j.execCommand("mceEndUndoLevel")},insertImage:function(k,r,m,t,u){var s=this.editor;var p=s.dom;var n=s.selection.getNode();n=p.getParent(n,"IMG");if(u){u=u.replace(/&/,"&amp;").replace(/</,"&lt;").replace(/>/,"&gt;").replace(/"/,"&quot;");var o=(m)?'style="width: '+m+'px;"':"";r=(r)?' alt="'+r+'"':"";m=(m)?' width="'+m+'"':"";t=(t)?' height="'+t+'"':"";var l='<div class="image-captioned"'+o+'><div class="image-captioned-image"><img src="'+k+'"'+r+m+t+' /></div><div class="image-captioned-caption">'+u+"</div></div>";this.insertSnippet(l);return}s.execCommand("mceBeginUndoLevel");if(n===null){s.execCommand("InsertImage",false,"#mce_temp_src#",{skip_undo:1});var j=tinymce.grep(p.select("img"),function(v){return(p.getAttrib(v,"src")=="#mce_temp_src#")});for(var q=0;q<j.length;q++){n=j[q];p.setAttrib(n,"src",k);if(r){p.setAttrib(n,"alt",r)}if(m){p.setAttrib(n,"width",m)}if(t){p.setAttrib(n,"height",t)}}}else{p.setAttrib(n,"src",k);if(r){p.setAttrib(n,"alt",r)}if(m){p.setAttrib(n,"width",m)}if(t){p.setAttrib(n,"height",t)}if(p.hasClass(n.parentNode.parentNode,"image-captioned")&&m){p.setAttrib(n.parentNode.parentNode,"style","width: "+m+"px")}}s.execCommand("mceEndUndoLevel")},insertSnippet:function(t){var s=this.editor;s.execCommand("mceBeginUndoLevel");s.selection.setContent("#mce_temp_content##mce_temp_cursor#");s.setContent(s.getContent().replace(/#mce_temp_content#/g,t));var m=this.editor.dom.select("body *");var l=null;var n=-1;for(var r=0;r<m.length;r++){for(var q=0;q<m[r].childNodes.length;q++){var k=m[r].childNodes[q];if(k.nodeType==3){n=k.nodeValue.indexOf("#mce_temp_cursor#");if(n!==-1){l=k;break}}}if(l!==null){break}}s.focus();if(l){var u=l.nodeValue.split("#mce_temp_cursor#",2);if(u[0]===""&&u[1]===""){var p=s.getDoc().createTextNode("");l.parentNode.replaceChild(p,l);s.selection.select(p);s.selection.collapse(false)}else{if(u[0]===""){var p=s.getDoc().createTextNode(u[1]);l.parentNode.replaceChild(p,l);s.selection.select(p);s.selection.collapse(true)}else{if(u[1]===""){var p=s.getDoc().createTextNode(u[0]);l.parentNode.replaceChild(p,l);s.selection.select(p);s.selection.collapse(false)}else{var o=s.getDoc().createTextNode(u[0]);var v=s.getDoc().createTextNode(u[1]);l.parentNode.replaceChild(v,l);v.parentNode.insertBefore(o,v);s.selection.select(o);s.selection.collapse(false)}}}}s.execCommand("mceEndUndoLevel")},drawSourceMode:function(){var j=this.editor;var k=j.getElement();k.className="swat-textarea swat-textarea-editor-source-mode";this.sourceContainer=document.createElement("div");this.sourceContainer.className="swat-textarea-container";this.sourceContainer.style.display="none";this.sourceContainer.style.zIndex="3";this.sourceContainer.style.position="absolute";k.parentNode.replaceChild(this.sourceContainer,k);this.sourceContainer.appendChild(k);k.style.display=null;k.style.width=null;this.drawModeSwitcher(j)},drawModeSwitcher:function(n){var n=this.editor;this.modeLink=[];visualSpan=document.createElement("span");visualSpan.appendChild(document.createTextNode(n.getLang("swat.mode_visual")));var j=document.createElement("a");j.href="#";if(this.mode!=a.MODE_SOURCE){j.className="selected"}j.appendChild(visualSpan);e.add(j,"click",function(t){e.prevent(t);var s=(this.mode!=a.MODE_VISUAL);this.setVisualMode();if(s){this.editor.focus()}},this);var k=document.createElement("li");k.appendChild(j);sourceSpan=document.createElement("span");sourceSpan.appendChild(document.createTextNode(n.getLang("swat.mode_source")));var q=document.createElement("a");q.href="#";if(this.mode==a.MODE_SOURCE){q.className="selected"}q.appendChild(sourceSpan);e.add(q,"click",function(v){e.prevent(v);var s=(this.mode!=a.MODE_SOURCE);this.setSourceMode();if(s){var t=this.editor.getElement();t.focus();if(t.setSelectionRange){t.setSelectionRange(0,0)}else{var u=t.createTextRange();u.collapse(true);u.moveToPoint(0)}}},this);var r=document.createElement("li");r.appendChild(q);var o=document.createElement("ul");o.className="swat-textarea-editor-mode-switcher";o.appendChild(r);o.appendChild(k);var l=i(this.editor);if(l){var p=g(l);o.style.width=(p.w+2)+"px";setTimeout(function(){var s=g(l);o.style.width=(s.w+2)+"px"},500)}var m=document.createElement("div");m.style.clear="right";n.getContainer().appendChild(o);n.getContainer().appendChild(m);this.modeLink[a.MODE_VISUAL]=j;this.modeLink[a.MODE_SOURCE]=q},initMode:function(){var j=this.editor;var k=document.getElementById(j.id+"_mode");if(k&&k.value==a.MODE_SOURCE){this.setSourceMode()}else{this.setVisualMode()}},setVisualMode:function(){if(this.mode==a.MODE_VISUAL){return}var k=this.editor;if(this.modeLink){h.removeClass(this.modeLink[a.MODE_SOURCE],"selected");h.addClass(this.modeLink[a.MODE_VISUAL],"selected")}var j=k.controlManager;for(var n in j.controls){if(n!=k.id+"_undo"&&n!=k.id+"_redo"){j.setDisabled(n,false)}}if(this.sourceContainer){this.sourceContainer.style.display="none"}var l=k.getElement();k.setContent(l.value);this.mode=a.MODE_VISUAL;var m=document.getElementById(k.id+"_mode");if(m){m.value=this.mode}},setSourceMode:function(){if(this.mode==a.MODE_SOURCE){return}var s=this.editor;if(this.modeLink){h.removeClass(this.modeLink[a.MODE_VISUAL],"selected");h.addClass(this.modeLink[a.MODE_SOURCE],"selected")}var y=s.controlManager;for(var l in y.controls){if(l!=s.id+"_undo"&&l!=s.id+"_redo"){y.setDisabled(l,true)}}var z=s.getBody().firstChild||s.getBody();var p=s.getWin().frameElement;var x=p.clientWidth;var r=p.clientHeight;var u=g(s.getContentAreaContainer());var n=s.getElement();var k=(tinymce.isIE)?n.currentStyle:getComputedStyle(n,null);var m=k.boxSizing;var j=0;if(m==="content-box"||!m){var o=parseInt(k.paddingTop,10)+parseInt(k.paddingBottom,10);var j=parseInt(k.paddingLeft,10);n.style.height=(r-o)+"px"}n.value=this.editor.getContent();this.sourceContainer.style.width=x+"px";this.sourceContainer.style.height=r+"px";this.sourceContainer.style.left=j+"px";if(YAHOO&&YAHOO.util&&YAHOO.util.Dom){var v=YAHOO.util.Dom.getElementsByClassName("mceToolbar","td",n.parentNode.parentNode).pop();if(v){var t=YAHOO.util.Dom.getRegion(v);this.sourceContainer.style.top=t.height+"px"}else{this.sourceContainer.style.top="29px"}}else{this.sourceContainer.style.top="29px"}this.sourceContainer.style.display="block";this.mode=a.MODE_SOURCE;var q=document.getElementById(s.id+"_mode");if(q){q.value=this.mode}},toggleMode:function(){if(this.mode==a.MODE_VISUAL){this.setSourceMode(true)}else{this.setVisualMode(true)}},getInfo:function(){return{longname:"Swat Plugin",author:"silverorange Inc.",authorurl:"http://www.silverorange.com/",version:"1.0"}}});tinymce.PluginManager.add("swat",tinymce.plugins.SwatPlugin)})();